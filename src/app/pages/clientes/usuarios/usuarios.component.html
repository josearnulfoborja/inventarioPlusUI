<div class="p-4">
    <h2 class="text-2xl font-bold mb-4">Gestión de Usuarios</h2>

    <div *ngIf="error" class="mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
        {{ error }}
    </div>

    <div class="mb-4">
        <button class="bg-green-500 text-white px-4 py-2 rounded mr-2" (click)="nuevo()">Nuevo Usuario</button>
        <button class="bg-gray-300 px-4 py-2 rounded" (click)="cargarUsuarios()">Refrescar</button>
    </div>

    <div *ngIf="isLoading">Cargando usuarios...</div>

    <div *ngIf="!isLoading && usuarios.length > 0" class="grid gap-3">
        <div *ngFor="let u of usuarios" class="border p-3 rounded flex justify-between items-start">
            <div>
                <div class="font-semibold">{{ u.nombre }} {{ u.apellido }}</div>
                <div class="text-sm text-gray-600">{{ u.correo_electronico }} • {{ u.username }}</div>
                <div class="text-sm text-gray-500">DUI: {{ u.dui || '-' }} • Tel: {{ u.telefono || '-' }}</div>
            </div>
            <div class="space-x-2">
                <button class="bg-blue-500 text-white px-3 py-1 rounded" (click)="editar(u)">Editar</button>
                <button class="bg-red-500 text-white px-3 py-1 rounded" (click)="eliminar(u.id_usuario)">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Paginación simple -->
    <div class="mt-4 flex items-center justify-between" *ngIf="totalPages > 1">
        <button (click)="previousPage()" [disabled]="currentPage === 1" class="px-3 py-1 bg-gray-200 rounded">Anterior</button>
        <span>Página {{ currentPage }} de {{ totalPages }}</span>
        <button (click)="nextPage()" [disabled]="currentPage === totalPages" class="px-3 py-1 bg-gray-200 rounded">Siguiente</button>
    </div>

    <!-- Formulario (crear/editar) en Dialog -->
    <p-dialog header="{{ editing ? 'Editar Usuario' : 'Crear Usuario' }}" [(visible)]="showForm" [modal]="true" [style]="{width: '700px'}" (onShow)="onDialogShow()">
    <div *ngIf="dialogMessageSuccess" class="mb-3 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">{{ dialogMessageSuccess }}</div>
    <div *ngIf="dialogMessageError" class="mb-3 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">{{ dialogMessageError }}</div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3" style="max-height:60vh; overflow:auto;">
            <input #firstInput [(ngModel)]="formModel.nombre" placeholder="Nombre" class="border p-2 rounded" />
            <input [(ngModel)]="formModel.apellido" placeholder="Apellido" class="border p-2 rounded" />
            <input [(ngModel)]="formModel.correo_electronico" placeholder="Correo electrónico" class="border p-2 rounded" />
            <input [(ngModel)]="formModel.telefono" placeholder="Teléfono" class="border p-2 rounded" />
            <input [(ngModel)]="formModel.dui" placeholder="DUI (00000000-0)" class="border p-2 rounded" />
            <input [(ngModel)]="formModel.username" placeholder="Username" class="border p-2 rounded" />
            <input [(ngModel)]="formModel.password" placeholder="Password" type="password" class="border p-2 rounded" />
        </div>

        <ng-template pTemplate="footer">
            <div class="p-dialog-footer">
                <button (click)="guardar()" class="bg-blue-600 text-white px-4 py-2 rounded">Guardar</button>
                <button (click)="cancelar()" class="bg-gray-300 px-4 py-2 rounded">Cancelar</button>
            </div>
        </ng-template>
    </p-dialog>

    <!-- Floating action bar to guarantee Save/Cancel visibility on any viewport -->
    <div *ngIf="showForm" class="fixed-save-bar">
        <button (click)="guardar()" class="bg-blue-600 text-white px-4 py-2 rounded">Guardar</button>
        <button (click)="cancelar()" class="bg-gray-300 px-4 py-2 rounded">Cancelar</button>
    </div>
</div>
