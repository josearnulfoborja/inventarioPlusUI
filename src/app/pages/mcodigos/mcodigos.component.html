<div class="card">
  <div class="card-header flex justify-between items-center p-4">
    <h2 class="text-lg font-semibold">Mantenimiento: mcodigos</h2>
    <div class="flex gap-3 items-center">
      <label class="text-sm" for="grupoSelect">Grupo:</label>
      <select id="grupoSelect" [(ngModel)]="filtroGrupo" (ngModelChange)="cambiarGrupo()" class="form-select">
        <option *ngFor="let g of grupos" [value]="g">{{ g }}</option>
      </select>
      <button class="btn btn-primary" (click)="nuevo()">+ Nuevo</button>
    </div>
  </div>
  <div class="p-4">
    <div *ngIf="errorMsg" class="mb-3 p-2 text-sm text-red-700 bg-red-50 border border-red-200 rounded">{{ errorMsg }}</div>
    <div *ngIf="successMsg" class="mb-3 p-2 text-sm text-green-700 bg-green-50 border border-green-200 rounded">{{ successMsg }}</div>
    <table class="min-w-full bg-white border" *ngIf="!cargando">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-3 py-2 text-left">ID</th>
          <th class="px-3 py-2 text-left">Grupo</th>
          <th class="px-3 py-2 text-left">Código</th>
          <th class="px-3 py-2 text-left">Nombre</th>
          <th class="px-3 py-2 text-left">Descripción</th>
          <th class="px-3 py-2 text-left">Orden</th>
          <th class="px-3 py-2 text-left">Activo</th>
          <th class="px-3 py-2 text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let m of mcodigos" class="border-b hover:bg-gray-50">
          <td class="px-3 py-2">{{ m.id }}</td>
          <td class="px-3 py-2">{{ m.grupo }}</td>
          <td class="px-3 py-2">{{ m.codigo }}</td>
          <td class="px-3 py-2">{{ m.nombre }}</td>
          <td class="px-3 py-2">{{ m.descripcion }}</td>
          <td class="px-3 py-2">{{ m.orden }}</td>
          <td class="px-3 py-2">{{ m.activo ? 'Sí' : 'No' }}</td>
          <td class="px-3 py-2 text-center">
            <button class="btn btn-sm btn-warning mr-2" (click)="editar(m)" [disabled]="guardando || eliminandoId === m.id">Editar</button>
            <button class="btn btn-sm btn-danger" (click)="eliminar(m.id)" [disabled]="eliminandoId === m.id">
              {{ eliminandoId === m.id ? 'Eliminando…' : 'Eliminar' }}
            </button>
          </td>
        </tr>
        <tr *ngIf="mcodigos.length === 0 && !cargando">
          <td colspan="8" class="px-3 py-4 text-center">No hay registros</td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="cargando" class="py-6 text-center text-sm text-gray-500">Cargando grupo {{ filtroGrupo }}...</div>

    <div *ngIf="mostrarFormulario" class="mt-4 p-4 border rounded bg-gray-50">
      <h3 class="mb-2">{{ esEdicion ? 'Editar' : 'Nuevo' }} registro</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div>
          <label class="block" for="inputGrupo">Grupo</label>
          <input id="inputGrupo" [(ngModel)]="elemento.grupo" name="grupo" class="form-control" readonly />
        </div>
        <div>
          <label class="block" for="inputCodigo">Código</label>
          <input id="inputCodigo" [(ngModel)]="elemento.codigo" name="codigo" class="form-control" required />
        </div>
        <div>
          <label class="block" for="inputNombre">Nombre</label>
          <input id="inputNombre" [(ngModel)]="elemento.nombre" name="nombre" class="form-control" required />
        </div>
        <div>
          <label class="block" for="inputOrden">Orden</label>
          <input id="inputOrden" type="number" [(ngModel)]="elemento.orden" name="orden" class="form-control" />
        </div>
        <div class="md:col-span-2">
          <label class="block" for="inputDescripcion">Descripción</label>
          <input id="inputDescripcion" [(ngModel)]="elemento.descripcion" name="descripcion" class="form-control" />
        </div>
        <div>
          <label class="inline-flex items-center mt-2">
            <input type="checkbox" [(ngModel)]="elemento.activo" name="activo" class="mr-2" /> Activo
          </label>
        </div>
      </div>
      <div class="mt-4">
        <button class="btn btn-success mr-2" [disabled]="guardando || !elemento.codigo || !elemento.nombre" (click)="guardar()">
          {{ guardando ? 'Guardando…' : 'Guardar' }}
        </button>
        <button class="btn btn-secondary" [disabled]="guardando" (click)="cancelar()">Cancelar</button>
      </div>
    </div>
  </div>
</div>

<!-- Debug: mostrar JSON recibido (temporal) -->
<!-- <div class="p-4 mt-4 bg-yellow-50 border border-yellow-100 rounded text-sm">
  <strong>DEBUG (temporal): datos recibidos</strong>
  <div class="mt-2">
    <div class="font-semibold">mcodigosOriginal (raw):</div>
    <pre style="max-height:200px;overflow:auto;background:#fff;padding:8px;border-radius:4px">{{ mcodigosOriginal | json }}</pre>
  </div>
  <div class="mt-2">
    <div class="font-semibold">mcodigos (filtrado / mostrado):</div>
    <pre style="max-height:200px;overflow:auto;background:#fff;padding:8px;border-radius:4px">{{ mcodigos | json }}</pre>
  </div>
</div> -->
